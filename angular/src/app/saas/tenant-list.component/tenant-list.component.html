<div class="card">
  <!-- Header Section -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4 gap-3">
    <div>
      <h3 class="text-2xl font-bold text-surface-900 dark:text-surface-0 m-0">{{ '::Tenants.Title' | abpLocalization }}</h3>
      <p class="text-surface-600 dark:text-surface-400 mt-1">{{ '::Tenants.Subtitle' | abpLocalization }}</p>
    </div>
    
    <div class="flex gap-2">
      <p-button 
        icon="pi pi-plus" 
        [label]="'::Tenants.NewTenant' | abpLocalization"
        severity="primary"
        (onClick)="openCreateDialog()"
        [pTooltip]="'::Tenants.NewTenantTooltip' | abpLocalization"
        tooltipPosition="bottom" />
    </div>
  </div>

  <!-- Search/Filter Section -->
  <div class="mb-4">
    <p-iconfield iconPosition="left" class="w-full md:w-96">
      <p-inputicon styleClass="pi pi-search" />
      <input 
        type="text" 
        pInputText 
        [placeholder]="'::Tenants.SearchPlaceholder' | abpLocalization"
        [value]="filterText"
        (input)="onFilter($event)"
        class="w-full" />
    </p-iconfield>
    
    @if (filterText) {
      <p-button 
        icon="pi pi-times" 
        [label]="'::Tenants.ClearFilter' | abpLocalization"
        [text]="true"
        severity="secondary"
        size="small"
        (onClick)="clearFilter()"
        class="mt-2" />
    }
  </div>

  <!-- Table Section -->
  <p-table 
    [value]="tenants"
    [lazy]="true"
    [paginator]="true"
    [rows]="rows"
    [totalRecords]="totalRecords"
    [loading]="loading"
    [first]="first"
    [rowsPerPageOptions]="[10, 25, 50, 100]"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} tenants"
    (onLazyLoad)="loadTenants($event)"
    [tableStyle]="{ 'min-width': '60rem' }"
    styleClass="p-datatable-gridlines"
    [globalFilterFields]="['name', 'id']">
    
    <!-- Table Header -->
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="name" style="min-width: 15rem">
          <div class="flex items-center">
            {{ '::Tenants.Table.TenantName' | abpLocalization }}
            <p-sortIcon field="name" />
          </div>
        </th>
        <th style="min-width: 15rem">{{ '::Tenants.Table.TenantId' | abpLocalization }}</th>
        <th style="min-width: 10rem">{{ '::Tenants.Table.FoodicsAccounts' | abpLocalization }}</th>
        <th style="min-width: 10rem">{{ '::Tenants.Table.Actions' | abpLocalization }}</th>
      </tr>
    </ng-template>

    <!-- Table Body -->
    <ng-template pTemplate="body" let-tenant>
      <tr>
        <td>
          <div class="flex items-center gap-2">
            <i class="pi pi-building text-primary text-xl"></i>
            <span class="font-semibold">{{ tenant.name }}</span>
          </div>
        </td>
        <td>
          <code class="text-sm bg-surface-100 dark:bg-surface-800 px-2 py-1 rounded">
            {{ tenant.id }}
          </code>
        </td>
        <td>
          <p-tag 
            [value]="getFoodicsAccountCount(tenant) + ' ' + ('::Tenants.AccountLabel' | abpLocalization)"
            [severity]="getFoodicsAccountCount(tenant) > 0 ? 'success' : 'secondary'"
            [rounded]="true" />
        </td>
        <td>
          <div class="flex gap-2">
            <p-button 
              icon="pi pi-pencil" 
              [rounded]="true"
              [outlined]="true"
              severity="secondary"
              size="small"
            [pTooltip]="'::Tenants.Actions.Edit' | abpLocalization"
              tooltipPosition="bottom" />
            
            <p-button 
              icon="pi pi-trash" 
              [rounded]="true"
              [outlined]="true"
              severity="danger"
              size="small"
              (onClick)="deleteTenant(tenant)"
              [pTooltip]="'::Tenants.Actions.Delete' | abpLocalization"
              tooltipPosition="bottom" />

            <p-button
              icon="pi pi-envelope"
              [rounded]="true"
              [outlined]="true"
              severity="info"
              size="small"
              (onClick)="resendWelcomeEmail(tenant)"
              pTooltip="Resend welcome email with new password"
              tooltipPosition="bottom" />
            
            <p-button 
              icon="pi pi-ellipsis-v" 
              [rounded]="true"
              [outlined]="true"
              severity="secondary"
              size="small"
              [pTooltip]="'::Tenants.Actions.MoreOptions' | abpLocalization"
              tooltipPosition="bottom" />
          </div>
        </td>
      </tr>
    </ng-template>

    <!-- Loading Template -->
    <ng-template pTemplate="loadingbody">
      <tr>
        <td>
          <div class="flex items-center gap-2">
            <p-skeleton shape="circle" size="2rem" />
            <p-skeleton width="10rem" styleClass="mb-2" />
          </div>
        </td>
        <td><p-skeleton width="15rem" styleClass="mb-2" /></td>
        <td><p-skeleton width="8rem" styleClass="mb-2" /></td>
        <td>
          <div class="flex gap-2">
            <p-skeleton shape="circle" size="2rem" />
            <p-skeleton shape="circle" size="2rem" />
            <p-skeleton shape="circle" size="2rem" />
          </div>
        </td>
      </tr>
    </ng-template>

    <!-- Empty Message -->
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="4">
          <div class="flex flex-col items-center justify-center py-8 text-center">
            <i class="pi pi-inbox text-6xl text-surface-400 mb-4"></i>
            <h4 class="text-xl font-semibold text-surface-700 dark:text-surface-300 mb-2">
              {{ '::Tenants.Empty.Title' | abpLocalization }}
            </h4>
            <p class="text-surface-600 dark:text-surface-400 mb-4">
              @if (filterText) {
                {{ '::Tenants.Empty.Filtered' | abpLocalization }}
              } @else {
                {{ '::Tenants.Empty.Default' | abpLocalization }}
              }
            </p>
            @if (!filterText) {
              <p-button 
                icon="pi pi-plus" 
                [label]="'::Tenants.Empty.CreateButton' | abpLocalization"
                severity="primary" />
            }
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<!-- Toast for notifications -->
<p-toast position="top-right" />

<!-- Confirmation Dialog -->
<p-confirmDialog />

<!-- Create Tenant Dialog -->
<p-dialog 
  [(visible)]="displayCreateDialog"
  [modal]="true"
  [style]="{ width: '650px' }"
  [draggable]="false"
  [resizable]="false"
  [dismissableMask]="false"
  styleClass="tenant-create-dialog"
  [header]="'::Tenants.Dialog.Title' | abpLocalization">
  
  <ng-template pTemplate="content">
    <form [formGroup]="createTenantForm" class="tenant-create-form">
      <!-- Tenant Name Field -->
      <div class="field-row">
        <label for="name" class="field-label">
          {{ '::Tenants.Dialog.NameLabel' | abpLocalization }}
        </label>
        <div class="field-control">
          <input 
            id="name"
            type="text" 
            pInputText 
            formControlName="name"
            [placeholder]="'::Tenants.Dialog.NamePlaceholder' | abpLocalization"
            autocomplete="off"
            class="flex-auto" />
          @if (isFieldInvalid('name')) {
            <p-message severity="error" size="small" variant="simple" class="mt-2">
              {{ getFieldError('name') }}
            </p-message>
          }
        </div>
      </div>

      <!-- Admin Email Field -->
      <div class="field-row">
        <label for="adminEmailAddress" class="field-label">
          {{ '::Tenants.Dialog.AdminEmailLabel' | abpLocalization }}
        </label>
        <div class="field-control">
          <input 
            id="adminEmailAddress"
            type="email" 
            pInputText 
            formControlName="adminEmailAddress"
            [placeholder]="'::Tenants.Dialog.AdminEmailPlaceholder' | abpLocalization"
            autocomplete="off"
            class="flex-auto" />
          @if (isFieldInvalid('adminEmailAddress')) {
            <p-message severity="error" size="small" variant="simple" class="mt-2">
              {{ getFieldError('adminEmailAddress') }}
            </p-message>
          }
        </div>
      </div>

      <!-- Info Message -->
      <div class="flex items-start gap-4 mt-6 p-4 surface-100 dark:surface-800 rounded-lg border-l-4 border-primary-500">
        <i class="pi pi-info-circle text-primary-500 text-xl"></i>
        <div class="flex flex-col gap-2">
          <span class="font-semibold text-surface-900 dark:text-surface-0">
            {{ '::Tenants.Dialog.InfoTitle' | abpLocalization }}
          </span>
          <span class="text-sm text-surface-600 dark:text-surface-400 leading-relaxed">
            {{ '::Tenants.Dialog.InfoText' | abpLocalization }}
          </span>
        </div>
      </div>
    </form>
  </ng-template>

  <ng-template pTemplate="footer">
    <div class="flex justify-end gap-2">
      <p-button 
        [label]="'::Common.Cancel' | abpLocalization" 
        icon="pi pi-times"
        severity="secondary"
        [outlined]="true"
        (onClick)="closeCreateDialog()"
        [disabled]="submitting" />
      
      <p-button 
        [label]="'::Tenants.Dialog.CreateButton' | abpLocalization" 
        icon="pi pi-check"
        severity="primary"
        (onClick)="createTenant()"
        [loading]="submitting"
        [disabled]="submitting" />
    </div>
  </ng-template>
</p-dialog>
