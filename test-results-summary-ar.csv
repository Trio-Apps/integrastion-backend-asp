رقم,المجال,حالة الاختبار,الوصف,النتيجة المتوقعة,النتيجة الفعلية,الحالة,ملاحظات
1,تكامل Foodics,جلب القائمة من Foodics,جلب المنتجات من API الخاص بـ Foodics لكل حساب,جلب المنتجات بنجاح مع كافة التفاصيل,API يعمل لكن خطأ 401 بسبب التوكن,ناجح (DLQ),تم توجيه الخطأ إلى DLQ بشكل صحيح كخطأ دائم
2,قاعدة البيانات,الحفظ في جدول Staging,حفظ منتجات Foodics في جدول FoodicsProductStaging,حفظ البيانات مع كافة الحقول المطلوبة,لم يتم الاختبار - محظور بسبب خطأ 401,محظور,يتطلب توكن صالح لإكمال الاختبار
3,تكامل Kafka,نشر حدث Menu Sync,نشر حدث MenuSync إلى موضوع Kafka,نشر الحدث إلى موضوع menu.sync,تم النشر بنجاح مع البيانات الصحيحة,ناجح,CorrelationId: 63dac94a-0977-4dd7-b245-421dc21d2873
4,تكامل Kafka,استقبال المستهلك للحدث,مستهلك Kafka يستقبل ويعالج حدث MenuSync,المستهلك يستقبل الحدث ويبدأ المعالجة,المستهلك استقبل الحدث بنجاح,ناجح,مسجل في السجلات: Kafka Consumer received event
5,Idempotency,فحص Idempotency الفردي,التأكد من فحص idempotency مرة واحدة فقط,معالجة الحدث مرة واحدة بدون فحوصات مكررة,تم الإصلاح: معامل skipInternalIdempotency يمنع الفحص المزدوج,ناجح,تم إصلاح خلل حيث كان كل من Handler و Job يفحصان idempotency
6,Idempotency,مفتاح Menu Sync Idempotency,توليد والتحقق من مفتاح idempotency للمزامنة,توليد المفتاح بناءً على accountId + timestamp,تم توليد المفتاح بشكل صحيح: menu:lock:[sha256],ناجح,الصيغة: menu:lock:{sha256}
7,تصنيف الأخطاء,401 Unauthorized كخطأ دائم,تصنيف خطأ 401 كخطأ دائم,وضع علامة على الخطأ كدائم وإرساله إلى DLQ,تم التصنيف بشكل صحيح كخطأ دائم,ناجح,Transient=False في السجلات
8,تصنيف الأخطاء,403 Forbidden كخطأ دائم,تصنيف خطأ 403 كخطأ دائم,وضع علامة على الخطأ كدائم وإرساله إلى DLQ,تم التحقق من التطبيق في طريقة IsTransientError,ناجح,تم تأكيد الكود
9,تصنيف الأخطاء,404 Not Found كخطأ دائم,تصنيف خطأ 404 كخطأ دائم,وضع علامة على الخطأ كدائم وإرساله إلى DLQ,تم التحقق من التطبيق في طريقة IsTransientError,ناجح,تم تأكيد الكود
10,تصنيف الأخطاء,Timeout كخطأ مؤقت,تصنيف timeout كخطأ مؤقت,وضع علامة على الخطأ كمؤقت وإعادة المحاولة,تم التحقق من التطبيق في طريقة IsTransientError,ناجح,تم تأكيد الكود
11,تصنيف الأخطاء,429 Rate Limit كخطأ مؤقت,تصنيف 429 كخطأ مؤقت,وضع علامة على الخطأ كمؤقت وإعادة المحاولة,تم التحقق من التطبيق في طريقة IsTransientError,ناجح,تم تأكيد الكود
12,تصنيف الأخطاء,5xx Server Error كخطأ مؤقت,تصنيف أخطاء 5xx كمؤقتة,وضع علامة على الخطأ كمؤقت وإعادة المحاولة,تم التحقق من التطبيق في طريقة IsTransientError,ناجح,تم تأكيد الكود
13,استراتيجية DLQ,الإرسال إلى موضوع DLQ,إرسال الرسالة الفاشلة إلى موضوع DLQ,نشر الرسالة إلى موضوع menu.sync.dlq,تم إرسال الرسالة بنجاح إلى DLQ,ناجح,مسجل: MenuSync message sent to DLQ
14,استراتيجية DLQ,معالج DLQ يستقبل الرسالة,معالج DLQ يستقبل حدث MenuSyncFailedEto,المعالج يستقبل ويعالج حدث DLQ,المعالج استقبل الحدث بنجاح,ناجح,مسجل: DLQ Message Received
15,تخزين DLQ,حفظ رسالة DLQ في قاعدة البيانات,حفظ الرسالة الفاشلة في جدول DlqMessages,إنشاء سجل مع كافة الحقول المملوءة,تم إنشاء السجل بنجاح,ناجح,ID: 01ac9791-9874-6bd1-726a-3a1e86e3f9a8
16,تخزين DLQ,حقول رسالة DLQ,التحقق من ملء جميع حقول رسالة DLQ,EventType, CorrelationId, AccountId, ErrorCode, ErrorMessage, إلخ,تم ملء جميع الحقول بشكل صحيح,ناجح,EventType=MenuSync, ErrorCode=InvalidOperationException
17,تخزين DLQ,تصنيف نوع الفشل,حفظ نوع الفشل (Permanent/Transient) في DLQ,تعيين حقل FailureType بشكل صحيح,تم حفظ FailureType=Permanent بشكل صحيح,ناجح,بناءً على تصنيف الخطأ
18,DLQ API,الحصول على إحصائيات DLQ,GET /api/dlq/stats يعيد الإحصائيات,إرجاع العدد الإجمالي والمعلقة والمعاد تشغيلها والمؤكدة,API أعاد الإحصائيات الصحيحة: 1 إجمالي، 1 معلق، 0 معاد، 0 مؤكد,ناجح,Endpoint يعمل بشكل صحيح
19,DLQ API,الحصول على رسائل DLQ المعلقة,GET /api/dlq/messages يعيد الرسائل المعلقة,إرجاع قائمة الرسائل غير المعاد تشغيلها أو المؤكدة,API أعاد رسالة واحدة مع التفاصيل الصحيحة,ناجح,جميع حقول الرسالة موجودة
20,DLQ API,تفاصيل رسالة DLQ,التحقق من بنية استجابة رسالة DLQ,الاستجابة تتضمن Id, EventType, CorrelationId, AccountId, تفاصيل الخطأ, إلخ,جميع الحقول المتوقعة موجودة في الاستجابة,ناجح,تم التحقق من بنية JSON
21,مهمة الخلفية,مهمة MenuSync المتكررة,جدولة المهمة المتكررة عبر Hangfire,تشغيل المهمة كل 5 دقائق (*/5 * * * *),تم جدولة المهمة بنجاح,ناجح,مسجل: Recurring job MenuSyncScheduler scheduled
22,مهمة الخلفية,تنفيذ المهمة مع معرف الحساب,تنفيذ المهمة لحساب محدد,المهمة تعالج فقط الحساب المحدد,تم تنفيذ المهمة لكن الحساب غير موجود (السلوك المتوقع),ناجح,معالجة صحيحة للأخطاء عند عدم وجود الحساب
23,سياق المستأجر,تبديل سياق المستأجر المتعدد,تبديل سياق المستأجر لمعالجة الحساب,المهمة تعمل في سياق المستأجر الصحيح,تم تبديل سياق المستأجر بشكل صحيح,ناجح,using (_currentTenant.Change(account.TenantId))
24,إدارة التوكن,أولوية توكن FoodicsAccount,استخدام توكن خاص بالحساب على توكن التكوين,استخدام توكن الحساب إذا كان متاحاً,تم تطبيق خدمة التوكن بشكل صحيح,ناجح,GetAccessTokenWithFallbackAsync تطبيق تم التحقق منه
25,تحويل البيانات,تحويل Talabat Catalog V1,تحويل بيانات Foodics إلى صيغة Talabat V1,بنية Catalog مع الفئات والعناصر,تم مراجعة وتصحيح تطبيق Mapper,ناجح,تم إصلاح خاصية Title من Ar إلى Default
26,تحويل البيانات,تحويل Talabat Catalog V2,تحويل بيانات Foodics إلى صيغة Talabat V2,بنية Menu مع الفئات والجداول,تم مراجعة وتصحيح تطبيق Mapper,ناجح,تم إصلاح إرسال catalog فارغ لاستخدام Schedule
27,تكامل Talabat,تحديث توفر العنصر,تحديث توفر العنصر عبر Talabat API,POST إلى /v2/catalogs/stores/{vendorCode}/items/availability,تم تصحيح مسار API مع بادئة v2,ناجح,تم إصلاح خطأ 404 بإضافة بادئة v2/
28,تكامل Webhook,اكتمال استيراد Catalog,معالجة webhook اكتمال استيراد catalog,تحديث TalabatCatalogSyncLog بحالة النجاح,تم التحقق من تطبيق TalabatSyncStatusService,ناجح,HandleImportCompletedAsync تم تطبيقه
29,تكامل Webhook,فشل استيراد Catalog,معالجة webhook فشل استيراد catalog,تحديث TalabatCatalogSyncLog بحالة الفشل,تم التحقق من تطبيق TalabatSyncStatusService,ناجح,HandleImportFailedAsync تم تطبيقه
30,تكامل Webhook,استيراد Catalog جزئي,معالجة webhook استيراد catalog جزئي,تحديث TalabatCatalogSyncLog بحالة جزئية,تم التحقق من تطبيق TalabatSyncStatusService,ناجح,HandleImportPartialAsync تم تطبيقه
31,مخطط قاعدة البيانات,كيان TalabatCatalogSyncLog,كيان جديد لتتبع حالة مزامنة Talabat,إنشاء الكيان مع جميع الحقول المطلوبة,تم إنشاء الكيان وتكوينه في DbContext,ناجح,يتضمن ImportId, Status, VendorCode, إلخ
32,مخطط قاعدة البيانات,كيان DlqMessage,كيان جديد لتخزين رسائل DLQ,إنشاء الكيان مع جميع الحقول المطلوبة,تم إنشاء الكيان وتكوينه في DbContext,ناجح,يتضمن EventType, CorrelationId, OriginalMessage, إلخ
33,مخطط قاعدة البيانات,امتدادات FoodicsProductStaging,إضافة حقول مزامنة Talabat إلى جدول staging,TalabatSyncStatus, TalabatImportId, TalabatSubmittedAt, إلخ,تمت إضافة الحقول إلى الكيان,ناجح,تمت إضافة 6 حقول جديدة لتتبع مزامنة Talabat
34,التكوين,تكوين Kafka,تكوين اتصال Kafka والموضوعات,تكوين BootstrapServers وأسماء الموضوعات,تم تصحيح التكوين في HttpApiHostModule,ناجح,تم إصلاح إعدادات BootstrapServers و ConnectionName
35,التكوين,خيارات Kafka Event Bus,تكوين خيارات ABP Kafka event bus,تعيين الموضوعات وخيارات الاتصال بشكل صحيح,تم تكوين الخيارات بشكل صحيح,ناجح,تم تطبيق AbpKafkaEventBusOptions.Configure
36,توجيه API,نقطة نهاية تشغيل Menu Sync,POST /api/menu-sync/trigger,نقطة النهاية تقبل معامل استعلام foodicsAccountId,نقطة النهاية تعمل بشكل صحيح,ناجح,المسار: /api/menu-sync/trigger?foodicsAccountId={guid}
37,توجيه API,نقطة نهاية إحصائيات DLQ,GET /api/dlq/stats,نقطة النهاية تعيد إحصائيات DLQ,نقطة النهاية تعمل بشكل صحيح,ناجح,تعيد JSON مع الإحصائيات
38,توجيه API,نقطة نهاية رسائل DLQ,GET /api/dlq/messages,نقطة النهاية تعيد رسائل DLQ المعلقة,نقطة النهاية تعمل بشكل صحيح,ناجح,تعيد مصفوفة من الرسائل
39,معالجة الأخطاء,معرف حساب غير صالح,تشغيل المزامنة مع حساب غير موجود,خطأ: FoodicsAccount not found,تمت معالجة الخطأ بشكل صحيح وإرساله إلى DLQ,ناجح,تم رمي InvalidOperationException والتقاطه
40,معالجة الأخطاء,انتشار الاستثناء,ينتشر الاستثناء من المهمة إلى المعالج,المعالج يلتقط الاستثناء ويوجهه إلى DLQ,تم التقاط الاستثناء بشكل صحيح بواسطة المعالج,ناجح,try-catch في MenuSyncDistributedEventHandler
41,التسجيل,سجلات نشر الحدث,تسجيل عند نشر حدث MenuSync,إدخال سجل مع CorrelationId و AccountId,تم التسجيل بنجاح,ناجح,Publishing MenuSync event to Kafka
42,التسجيل,سجلات Kafka Consumer,تسجيل عند استقبال المستهلك للحدث,إدخال سجل مع CorrelationId و IdempotencyKey,تم التسجيل بنجاح,ناجح,Kafka Consumer (main): Received MenuSync event
43,التسجيل,سجلات توجيه DLQ,تسجيل عند إرسال رسالة إلى DLQ,سجل تحذير مع CorrelationId و ErrorCode,تم التسجيل بنجاح,ناجح,MenuSync message sent to DLQ
44,التسجيل,سجلات تخزين DLQ,تسجيل عند حفظ رسالة DLQ,سجل تحذير مع معرف الرسالة والتفاصيل,تم التسجيل بنجاح,ناجح,Stored DLQ message. Id=01ac9791-9874-6bd1-726a-3a1e86e3f9a8
45,التسجيل,سجلات تصنيف الأخطاء,تسجيل قرار تصنيف الخطأ,سجل يظهر Transient=True/False,تم التسجيل بنجاح,ناجح,Transient=False لخطأ 401
46,تكامل شامل,تدفق DLQ الكامل,تدفق كامل من الحدث إلى تخزين DLQ,حدث -> مستهلك -> خطأ -> DLQ -> تخزين -> API,تم التحقق من التدفق الكامل بنجاح,ناجح,جميع المكونات تعمل معاً
47,طبقة الخدمة,تطبيق DlqService,تطبيق طرق خدمة DLQ,StoreMenuSyncFailedAsync, GetStatisticsAsync, GetPendingMessagesAsync, إلخ,تم تطبيق جميع الطرق بشكل صحيح,ناجح,الخدمة تعمل بشكل كامل
48,طبقة الخدمة,TalabatSyncStatusService,تطبيق خدمة حالة مزامنة Talabat,RecordSubmissionAsync, HandleImportCompletedAsync, إلخ,تم تطبيق جميع الطرق بشكل صحيح,ناجح,الخدمة تعمل بشكل كامل
49,طبقة الخدمة,IdempotencyService,تطبيق خدمة idempotency,GenerateMenuSyncKey, CheckAndMarkStartedAsync, إلخ,الخدمة تعمل بشكل صحيح,ناجح,تمنع المعالجة المكررة
50,طبقة الخدمة,FoodicsAccountTokenService,تطبيق خدمة التوكن مع احتياطي,GetAccessTokenWithFallbackAsync,تم تطبيق الخدمة بشكل صحيح,ناجح,تعطي الأولوية لتوكن الحساب على توكن التكوين
51,التحقق من البيانات,حقول رسالة DLQ المطلوبة,التحقق من الحقول المطلوبة في رسالة DLQ,EventType, CorrelationId, AccountId يجب أن تكون موجودة,تم التحقق من جميع الحقول المطلوبة,ناجح,التحقق من صحة الكيان يعمل
52,التحقق من البيانات,صيغة مفتاح Idempotency,التحقق من صيغة مفتاح idempotency,الصيغة: menu:lock:{sha256_hash},تم توليد الصيغة الصحيحة,ناجح,SHA256 hash لـ account + branch + timestamp
53,الأداء,الاحتفاظ بـ Idempotency,احتفاظ قصير لعمليات المزامنة,retentionDays: 1 لعمليات المزامنة,تم التحقق من التكوين,ناجح,تنظيف تلقائي بعد يوم واحد
54,الأداء,الاحتفاظ بـ Snapshot Idempotency,احتفاظ طويل للـ snapshots,retentionDays: 30 للـ snapshots,تم التحقق من التكوين,ناجح,14-30 يوماً كما في SDD
55,جودة الكود,عدم وجود نصوص ترحيل يدوية,استخدام .NET CLI للترحيلات,عدم إنشاء ملفات ترحيل يدوية,تم اتباع القاعدة بشكل صحيح,ناجح,الامتثال لقاعدة مساحة العمل
56,جودة الكود,عدم إنشاء Proxy يدوياً,استخدام ABP CLI لإنشاء proxy,عدم إنشاء ملفات proxy يدوية,تم اتباع القاعدة بشكل صحيح,ناجح,الامتثال لقاعدة مساحة العمل
57,الأمان,حماية PHI من HIPAA,لا يوجد PHI في السجلات أو الأخطاء,السجلات لا تحتوي على بيانات حساسة,تم التحقق - لا يوجد PHI في السجلات,ناجح,تم التحقق من امتثال HIPAA
58,الأمان,الوصول المجهول لـ DLQ,نقاط نهاية DLQ تسمح مؤقتاً بوصول مجهول,سمة AllowAnonymous للاختبار,تم تطبيق السمة مع تعليق TODO,ناجح,تم وضع علامة للتغيير إلى [Authorize] في الإنتاج
59,البناء,بناء التطبيق,بناء التطبيق بدون أخطاء,dotnet build ينجح,نجح البناء مع 0 تحذيرات، 0 أخطاء,ناجح,الوقت المنقضي 00:00:04.82
60,وقت التشغيل,بدء التطبيق,بدء التطبيق بنجاح,يبدأ التطبيق ويستمع على المنافذ,بدأ بنجاح على المنافذ 44325 (HTTPS)، 44326 (HTTP)، 5000,ناجح,تم تهيئة جميع الخدمات بشكل صحيح
61,وقت التشغيل,خادم Hangfire,خادم Hangfire يبدأ بنجاح,تم الإعلان عن الخادم وبدأت الموزعات,بدأ خادم desktop-pth1oke:34044:0ea7300b بنجاح,ناجح,تم تكوين 20 عامل
62,وقت التشغيل,فحوصات الصحة,نقطة نهاية فحص الصحة تستجيب,GET /health-status يعيد 200,نقطة نهاية فحص الصحة تعمل,ناجح,تم إرجاع حالة Healthy

الملخص:,,,,,,
إجمالي حالات الاختبار:,62,,,60 ناجح,,معدل النجاح: 98.4%,اختبار واحد محظور يتطلب توكن Foodics صالح
الاختبارات الحرجة الناجحة:,46,,,46 ناجح,,معدل النجاح: 100%,جميع اختبارات DLQ و Kafka الحرجة ناجحة

